@model AvgMeasurementModel
<style>
    .center-table {
        width: 100%;
        margin: auto;
        text-align: left;
        border-collapse: collapse;
        border: 1px solid #ddd; /* Light gray border */
    }

        .center-table th {
            background-color: #f2f2f2; /* Light gray background for header */
            font-weight: bold;
            padding: 10px;
            border: 1px solid #ddd; /* Light gray border */
        }

        .center-table td {
            padding: 10px;
            border: 1px solid #ddd; /* Light gray border */
        }

        .center-table tr:nth-child(even) {
            background-color: #f9f9f9; /* Alternate row background */
        }

    .kpi-name {
        background-color: #e6f2ff; /* Light blue background for KPI names */
        position: sticky;
        left: 0;
        z-index: 2; /* Ensure it stays above other cells during scrolling */
    }

    .rate {
        background-color: #eaf1dd; /* Light green background for total rate */
    }

    .avg {
        background-color: #f9eec1; /* Light yellow background for total average */
    }

    .name {
        background-color: #e2e2e2; /* Light gray background for manager names */
    }

    .manager {
        background-color: #ffd1b3; /* Light orange background for managers */
    }

    /* Horizontal scrolling */
    .scrollable-table {
        overflow-x: auto;
        white-space: nowrap;
    }
</style>
<div class="data">
    @if (Model == null)
    {
        <p>No data available.</p>
    }
    else if (Model.KPIName == null)
    {
    }
    else if (!Model.KPIName.Any())
    {
        <p>KPIName is empty</p>
    }
    else
    {
        <div class="scrollable-table">
            <table class="center-table">
                <!-- Table headers -->
                <tr>
                    <!-- Loop through distinct manager names -->
                    <th class="name kpi-name">KPIName</th>
                    @foreach (var item in Model.Months)
                    {
                        <th class="manager">@item.Text</th>
                    }
                    @* <th class="rate">Total Rate</th>*@
                    @* <th class="avg">Total Rating</th>*@
                    <th class="avg">Total Average</th>
                </tr>
                <!-- Table body -->
                @foreach (var kpi in Model.KPIName)
                {
                    <tr>
                        <td class="kpi-name">@kpi</td>
                        <!-- Loop through rates for each KPI -->
                        @foreach (var rate in Model.employeeTotalAvgRates.Where(e => e.KPIName == kpi))
                        {
                            <td>@rate.AvgRateing.ToString("F2")</td>

                        }
                        <!-- Display total rate and average rate -->
                        <td>
                            @{
                                var average = Model.employeeTotalAvgRates
                                .Where(item => item.KPIName == kpi)
                                .Select(item => item.AvgRateing)
                                .ToList();

                                // Check if there are any ratings to calculate the average
                                if (average.Any())
                                {
                                    @average.Average().ToString("F2")
                                }
                                else
                                {
                                    @:N/A  <!-- or you can use - or any placeholder you prefer -->
                                }
                            }
                        </td>
                        @* <td>@Model.employeeTotalAvgRates.FirstOrDefault(item => item.KPIName == kpi)?.AvgRateing</td> *@
                    </tr>
                }
            </table>
        </div>
    }
</div>
