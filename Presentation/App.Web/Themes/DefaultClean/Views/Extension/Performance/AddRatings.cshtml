@using App.Core
@using App.Web.Models.PerformanceMeasurements;
@model PerformanceMeasurementModel
@inject App.Core.IWebHelper webHelper
@{
    Layout = "_ColumnsTwo";

    //title
    NopHtml.AddTitleParts(T("PageTitle.Career").Text);
    //page class
    NopHtml.AppendPageCssClassParts("html-account-page");
    NopHtml.AppendPageCssClassParts("html-career-result-page");
}

@section left
{
    @await Component.InvokeAsync(typeof(CustomerNavigationViewComponent), new { selectedTabId = CustomerNavigationEnum.AddRatings })
}

<link rel="stylesheet" href="https://kendo.cdn.telerik.com/themes/8.2.1/default/default-main.css" />
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Kendo UI JS -->
<script src="https://kendo.cdn.telerik.com/2023.2.829/js/kendo.all.min.js"></script>
<form asp-controller="Performance" asp-action="AddRatings" method="post">
    <div class="content-header clearfix">
        <h1 class="float-left">
            @T("Admin.Configuration.TeamPerformanceMeasurement")
        </h1>
        <div class="float-right page-btn">
            <a asp-action="AddRatings" class="reset-btn btn btn-primary">
                <i class="fas fa-plus-square"></i>
                @T("Admin.PerformanceMeasurement.Reset")
            </a>
            @if (await permissionService.AuthorizeAsync(StandardPermissionProvider.PublicStoreAddRating, PermissionAction.Add))
            {
                <button type="button" name="save" class="btn-search btn btn-primary">
                    <i class="far fa-save"></i>
                    @T("Admin.Common.Save")
                </button>
            }
        </div>

    </div>

    
        <style>
            .center-table {
                width: 100%;
                margin: auto;
                text-align: center;
                border-collapse: collapse;
                border: 1px solid black;
            }

                .center-table th,
                .center-table td {
                    border: 1px solid black;
                }
        </style>
        <section class="content">
            <div class="container-fluid">
                <div class="form-horizontal">
                    <div class="cards-group">
                        <div class="card card-default card-popup">
                            <div class="card-body">
                                <div class="same-row">
                                <div class="form-group row">
                                    <div class="col-sm-3">

                                        <nop-label asp-for="Year" />
                                    </div>
                                    <div class="col-sm-4">
                                        <nop-select asp-for="Year" asp-items="Model.Years" />
                                        <span asp-validation-for="Year"></span>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <div class="col-sm-3">
                                        <input type="hidden" asp-for="@Model.Id" />
                                        <nop-label asp-for="MonthName" />
                                    </div>
                                    <div class="col-sm-4">
                                        <nop-select asp-for="MonthId" asp-items="Model.Months"/>
                                        <span asp-validation-for="MonthId"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-md-3">
                                    <label asp-for="EmployeeId" asp-postfix=":"></label>
                                </div>
                                <div class="col-md-4">
                                    <input type="hidden" id="EmployeeId" name="EmployeeId" value="@Model.EmployeeId" />
                                    <select id="employeeDropdown" name="employeeDropdown" class="form-control" style="border: none; box-shadow: none; height:35px; "></select>
                                    <span style="color:red; " id="dateError"></span>
                                </div>
                            </div>
                          
                                <br />
                                <br />

                                @if (Model.EmployeeId > 0)

                                {
                                    <div class="data">
                                        <table class="center-table">
                                            <tr>
                                                <th><label>KPIName</label></th>
                                                <th><label>Rating</label></th>
                                            </tr>

                                            @for (int i = 0; i < Model.KPIMaster.Count; i++)
                                            {
                                                <tr>
                                                    <input type="hidden" asp-for="@Model.KPIMaster[i].Id" />
                                                    <input type="hidden" asp-for="@Model.KPIMaster[i].Name" />
                                                    <td>@Model.KPIMaster[i].Name</td>
                                                    <td><input asp-for="@Model.KPIMaster[i].Rating" /></td>
                                                </tr>
                                            }

                                        </table>

                                        <br />
                                        <br />
                                        <div class="form-group row">
                                            <div class="col-sm-1.5">
                                            <nop-label asp-for="Feedback"/>
                                            </div>
                                            <div class="col-sm-3">
                                                <nop-textarea asp-for="Feedback" />
                                                <span asp-validation-for="Feedback"></span>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    



</form>

    <script>
   
    $(document).ready(function () {

        var preselectedEmployeeId = @Model.EmployeeId; // Server-side value for the preselected EmployeeId

        // Initialize the Kendo DropDownList
        $('#employeeDropdown').kendoDropDownList({
            dataTextField: "Text",
            dataValueField: "Value",
            filter: "contains",
            autoBind: true, // Ensure data is bound immediately
            dataSource: @Html.Raw(Json.Serialize(Model.Employees)),
            value: preselectedEmployeeId, // Set the pre-selected value
        });
 
    });
    </script>


<script>
    $(document).ready(function () {
        // Attach validation to the Save button
        $('button[name="save"]').click(function (e) {
            // Prevent form submission initially
            e.preventDefault();
            console.log("call");
            // Check KPI ratings validation
            var isValid = true;
            $('.center-table input[type="number"]').each(function () {
                var value = parseFloat($(this).val()); // Parse input value to float
                console.log(value);

                if (value < 0 || isNaN(value) || value >10) { // Check if the value is negative, zero, or invalid
                    isValid = false;
                   
                }
            });

            if (!isValid) {
                alert('Please enter valid KPI ratings'); // Show error message
            } else {
                // Submit the form if all inputs are valid

                $('form').submit();
            }
        });
    });

    $(document).ready(function () {

        // Bind change event dynamically using jQuery
        $('#employeeDropdown').change(function () {
            redirectToAction();
        });

        // $('#managerDropdown').change(function () {
        //     redirectToAction();
        // });
        $('#MonthId').change(function () {
            redirectToAction();
        });
        $('#Year').change(function () {
            redirectToAction();
        });


    @if (Model.Employees.Count == 0)
    {
        <text>
                selectElement.setOptions({
                    enable: false,
                    placeholder: '@T("Admin.Catalog.Employee.NoEmployee")'
                });
            selectElement._placeholder();
            selectElement._enable();
        </text>
    }
        });

    function redirectToAction() {
        var selectedEmployeeIds = $('#employeeDropdown').val(); // Get selected employee IDs
        var selectedMonthId = $('#MonthId').val(); // Get selected month ID
      
        var selectedYear = $('#Year').val();
        console.log(selectedEmployeeIds);

        if (selectedEmployeeIds) {
            var url = '@Url.Action("AddRatings", "Performance")' +
                '?monthId=' + selectedMonthId +
                '&employeeId=' + selectedEmployeeIds + '&year=' + selectedYear;

            window.location.href = url; // Redirect to the specified URL
        }
    }
</script>
<style>

    .main {
        display: block;
    }

    .row {
        display: flex;
        justify-content: space-evenly;
        align-items: baseline;
    }

    .col-sm-4 {
        margin-left: 2px;
    }

    .select1 {
        min-width: 160px;
        height: 40px;
        padding: 6px;
    }

    .button1 {
        text-align: center;
    }

    .btn-search {
        padding: 8px 25px;
        border-radius: 10px;
    }
</style>

<style>
    #summary-table {
        width: 100%;
        font-family: Arial, sans-serif;
        border-collapse: collapse;
        border: 2px solid #dcdcdc;
    }

        #summary-table th, #summary-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        #summary-table th {
            background-color: #f5f5f5;
            font-weight: bold;
            text-align: left;
        }

        #summary-table td {
            text-align: right; /* Right-align the numeric data */
        }

    .cards-group {
        display: flex;
        flex-direction: column;
        gap: 20px;
        padding: 20px;
    }

    .card-default {
        border: 1px solid #ccc;
        padding: 20px;
        border-radius: 5px;
        background-color: #f9f9f961;
    }

    .card-body {
        padding: 15px;
    }

    .row {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        margin-bottom: 10px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        width: 90%;
    }

        .form-group label {
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: bold;
        }

        .form-group select,
        .form-group input {
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
            height: 40px;
            
            width: 290px;
          
        }
        .k-picker{
            width:290px;
        }

    .reset-btn {
        padding: 10px 20px;
        font-size: 0.875rem;
        line-height: 1.5;
        text-transform: uppercase;
        background-color: #aaa;
        color: #fff;
        border: none;
        cursor: pointer;
        margin: 1%;
    }

    .same-row{
        display:flex;
      

    }
        .reset-btn:hover {
            background-color: #bbb;
        }

    .error-message {
        color: red;
        font-size: 12px;
        margin-top: 5px;
    }

    .btn-search {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

        .btn-search:hover {
            background-color: #0056b3;
        }

    .content-header{
        display:flex;
        justify-content:space-between;
    }

    .page-btn{
        display:flex;
        justify-content:space-around;
    }
    /* Row */
    .row {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 10px;
    }

    /* Column */
    .col-md-6 {
        /* flex: 0 0 50%; */
        max-width: 50%;
        padding: 1px;
    }

    /* Button search */
    .btn-search {
        min-width: 105px;
        border: 0;
        background-color: #4ab2f1;
        padding: 10px 24px;
        text-align: center;
        font-size: 15px;
        color: #fff;
        text-transform: uppercase;
        margin: 1%;
        border-radius: 0;
        text-wrap: nowrap;
    }

        .btn-search:hover {
            background-color: #248ece;
        }

    #employeeDropdown{
        width:300px;
    }

    textarea{
        min-height:100px;
        min-width:250px;
    }
</style>